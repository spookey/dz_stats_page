{% from '_macros/elems.html' import text_color %}
{% from '_macros/elems.html' import text_icon %}
{% from '_macros/elems.html' import time_abs %}
{% from '_macros/elems.html' import time_rel %}
{% from 'mgnt/_macros/level.html' import key_val_level %}
{% from 'mgnt/_macros/level.html' import link_head_code %}
{% from 'mgnt/_macros/level.html' import link_head_title %}
{% from 'mgnt/_macros/level.html' import linking_level %}

{% macro create_button(endpoint) %}
<div class="content has-text-right">
  <a
    class="button is-dark"
    href="{{ url_for(endpoint, slug=None) }}"
  >
    {{ text_icon('ops_create') }}
    <span>Create new</span>
  </a>
</div>
{% endmacro %}


{% macro _common_info(thing, endpoint) %}
{% if thing %}
<div class="content">
  {{ linking_level(
    'Title',
    link_head_title(thing.title, url_for(endpoint, slug=thing.slug), sub=false),
    'Slug',
    link_head_code(thing.slug, url_for(endpoint, slug=thing.slug), sub=true),
  ) }}
  <div class="box">
    <div class="media">
      <div class="media-content">
        {% if thing.description %}
        <div class="content">
          <p>
            <strong>Description</strong>
            <blockquote>{{ thing.description }}</blockquote>
          </p>
        </div>
        {% endif %}
        {{ key_val_level(
          'Created',
          time_abs(thing.created_epoch_ms, thing.created_fmt),
        ) }}
        {{ caller() }}
      </div>
    </div>
  </div>
</div>
{% endif %}
{% endmacro %}


{% macro show_sensor(sensor) %}
{% call() _common_info(sensor, 'mgnt.edit_sensor') %}
{{ key_val_level(
  'Points',
  sensor.length,
) }}
{% if sensor.latest %}
{{ key_val_level(
  'Latest',
  time_rel(sensor.latest.created_epoch_ms, sensor.latest.created_fmt),
) }}
{% endif %}
{% endcall %}
{% endmacro %}

{% macro show_prompt(prompt) %}
{% call() _common_info(prompt, 'mgnt.edit_prompt') %}
{% endcall %}
{% endmacro %}

{% macro show_mapper(mapper) %}
{% if mapper %}
<div class="content">
  {% with href = url_for(
    'mgnt.edit_mapper',
    prompt_slug=mapper.prompt.slug,
    sensor_slug=mapper.sensor.slug,
  ) %}
  {{ linking_level(
    'Prompt',
    link_head_code(mapper.prompt.slug, href, sub=true),
    'Sensor',
    link_head_code(mapper.sensor.slug, href, sub=true),
  ) }}
  {% endwith %}
  <div class="box">
    <div class="media">
      <div class="media-content">
        {{ key_val_level(
          'Created',
          time_abs(mapper.created_epoch_ms, mapper.created_fmt),
        ) }}
        {{ key_val_level(
          'Active',
          'Yes' if mapper.active else 'No',
        ) }}
        {{ key_val_level(
          'Color',
          text_color(mapper.color.name, mapper.color.color),
        ) }}
        {{ key_val_level(
          'Convert',
          mapper.convert.name,
        ) }}
        {{ key_val_level(
          'Horizon',
          mapper.horizon.name,
        ) }}
      </div>
    </div>
  </div>
</div>
{% endif %}
{% endmacro %}
